<!DOCTYPE html>
<html>
<head>
  <title>Smart Address Finder</title>
  <style>
    body {
      font-family: Arial;
      max-width: 540px;
      margin: 50px auto;
      text-align: center;
    }
    input {
      width: 95%;
      padding: 12px;
      font-size: 16px;
    }
    button {
      padding: 10px 20px;
      margin-top: 12px;
      font-size: 16px;
      cursor: pointer;
    }
    .result {
      margin-top: 20px;
      background: #f3f3f3;
      padding: 15px;
      border-radius: 6px;
      text-align: left;
    }
    .note {
      font-size: 13px;
      color: #555;
      margin-top: 8px;
    }
  </style>
</head>
<body>

<h2>Find Full Address</h2>

<input id="query" placeholder="Type any partial address" />
<br>
<button onclick="findAddress()">Get Full Address</button>

<div id="result" class="result" style="display:none;"></div>

<script>
// ðŸ”‘ PASTE YOUR FREE OPENROUTER KEY HERE
const AI_KEY = "PASTE_YOUR_KEY_HERE";

function cleanInput(text) {
  return text
    .toLowerCase()
    .replace(/near|opp|opposite|behind|beside|nr|road|rd|street|st/gi, "")
    .replace(/\s+/g, " ")
    .trim();
}

async function aiRewrite(text) {
  if (!AI_KEY || AI_KEY.includes("PASTE")) return null;

  const res = await fetch("https://openrouter.ai/api/v1/chat/completions", {
    method: "POST",
    headers: {
      "Authorization": "Bearer " + AI_KEY,
      "Content-Type": "application/json"
    },
    body: JSON.stringify({
      model: "openai/gpt-3.5-turbo",
      messages: [{
        role: "user",
        content: `Rewrite this into a proper Indian location name: ${text}`
      }],
      max_tokens: 40
    })
  });

  const data = await res.json();
  return data.choices?.[0]?.message?.content || null;
}

async function searchNominatim(q) {
  const url = `https://nominatim.openstreetmap.org/search?format=json&limit=1&q=${encodeURIComponent(q)}`;
  const res = await fetch(url);
  const data = await res.json();
  return data.length ? data[0].display_name : null;
}

async function findAddress() {
  const raw = document.getElementById("query").value;
  if (!raw) return alert("Type something first");

  const cleaned = cleanInput(raw);
  let result = await searchNominatim(cleaned);

  // ðŸ§  AI RESCUE STEP
  if (!result) {
    const rewritten = await aiRewrite(cleaned);
    if (rewritten) {
      result = await searchNominatim(rewritten);
    }
  }

  const box = document.getElementById("result");
  box.style.display = "block";

  if (!result) {
    box.innerHTML = `
      <b>Could not confidently find this address.</b><br><br>
      Try adding a nearby landmark or area.
    `;
    return;
  }

  box.innerHTML = `
    <b>Best Match:</b><br><br>
    ${result}
    <br><br>
    <button onclick="navigator.clipboard.writeText('${result}')">
      Copy Address
    </button>
    <div class="note">
      Best possible match based on public data. Please verify.
    </div>
  `;
}
</script>

</body>
</html>
