<!DOCTYPE html>
<html>
<head>
  <title>Smart Address Finder</title>
  <style>
    body {
      font-family: Arial;
      max-width: 520px;
      margin: 50px auto;
      text-align: center;
    }
    input {
      width: 95%;
      padding: 12px;
      font-size: 16px;
    }
    button {
      padding: 10px 20px;
      margin-top: 12px;
      font-size: 16px;
      cursor: pointer;
    }
    .result {
      margin-top: 20px;
      background: #f3f3f3;
      padding: 15px;
      border-radius: 6px;
      text-align: left;
    }
    .note {
      font-size: 13px;
      color: #555;
      margin-top: 8px;
    }
  </style>
</head>
<body>

<h2>Find Full Address</h2>

<input id="query" placeholder="Type any partial address (even 2 words)" />
<br>
<button onclick="findAddress()">Get Full Address</button>

<div id="result" class="result" style="display:none;"></div>

<script>
function cleanInput(text) {
  return text
    .toLowerCase()
    .replace(/near|opp|opposite|behind|beside|nr|road|rd|street|st/gi, "")
    .replace(/\s+/g, " ")
    .trim();
}

async function searchNominatim(q) {
  const url = `https://nominatim.openstreetmap.org/search?format=json&addressdetails=1&limit=1&q=${encodeURIComponent(q)}`;
  const res = await fetch(url);
  const data = await res.json();
  return data.length ? data[0].display_name : null;
}

async function searchPhoton(q) {
  const url = `https://photon.komoot.io/api/?limit=1&q=${encodeURIComponent(q)}`;
  const res = await fetch(url);
  const data = await res.json();
  if (data.features && data.features.length) {
    return data.features[0].properties.name + ", " +
           data.features[0].properties.city + ", " +
           data.features[0].properties.state + ", " +
           data.features[0].properties.country;
  }
  return null;
}

async function findAddress() {
  const raw = document.getElementById("query").value;
  if (!raw) return alert("Type something first");

  const cleaned = cleanInput(raw);

  const attempts = [
    cleaned,
    cleaned + " india",
    cleaned + " mumbai",
    cleaned.split(" ").reverse().join(" ")
  ];

  let result = null;

  for (let q of attempts) {
    result = await searchNominatim(q);
    if (result) break;
  }

  if (!result) {
    for (let q of attempts) {
      result = await searchPhoton(q);
      if (result) break;
    }
  }

  const box = document.getElementById("result");
  box.style.display = "block";

  if (!result) {
    box.innerHTML = `
      <b>No exact address found.</b><br><br>
      Try adding a nearby landmark or area name.
    `;
    return;
  }

  box.innerHTML = `
    <b>Best Match:</b><br><br>
    ${result}
    <br><br>
    <button onclick="navigator.clipboard.writeText('${result}')">
      Copy Address
    </button>
    <div class="note">
      This is the closest match based on public map data. Please verify before use.
    </div>
  `;
}
</script>

</body>
</html>
